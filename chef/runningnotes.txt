
$ cat helloworld.rb
file '/tmp/f1.txt' do
  content 'Hello world'
  action :create
end

$ chef-apply helloworld.rb
Recipe: (chef-apply cookbook)::(chef-apply recipe)
  * file[/tmp/f1.txt] action create
    - create new file /tmp/f1.txt
    - update content in file /tmp/f1.txt from none to 64ec88
    --- /tmp/f1.txt     2018-11-21 06:50:50.843300171 +0000
    +++ /tmp/.chef-f120181121-3054-194pjkx.txt  2018-11-21 06:50:50.839300113 +0000
    @@ -1 +1,2 @@
    +Hello world

################### Creating a cookbook
vagrant@33m~/nov21
$ mkdir cookbooks

vagrant@33m~/nov21
$ ls
cookbooks  helloworld.rb

vagrant@33m~/nov21
$ cd cookbooks

vagrant@33m~/nov21/cookbooks
$ chef generate cookbook apache2
########### Make a recipe entry in default.rb
vagrant@33m~/nov21/cookbooks/apache2
$ cat recipes/default.rb
file '/tmp/f1.txt' do
  content 'Hello world'
  action :create
end

service 'apache2' do
  action :start
end

######### Run the cookbook
vagrant@33m~/nov21
$ sudo chef-client --local-mode --runlist 'recipe[apache2]'
[2018-11-21T07:17:21+00:00] WARN: No config file found or specified on command line, using command line options.
Starting Chef Client, version 12.16.42
resolving cookbooks for run list: ["apache2"]
Synchronizing Cookbooks:
  - apache2 (0.1.0)
Installing Cookbook Gems:
Compiling Cookbooks...
Converging 2 resources
Recipe: apache2::default
  * file[/tmp/f1.txt] action create (up to date)
  * service[apache2] action start (up to date)

Running handlers:
Running handlers complete
Chef Client finished, 0/2 resources updated in 02 seconds

########### Multiple files in a cookbook

vagrant@33m~/nov21/cookbooks/apache2/recipes
$ cat default.rb
package 'apache2' do
  action :install
end
cookbook_file '/etc/apache2/ports.conf' do
  source 'ports.conf'
  action :create
end
service 'apache2' do
  action :restart
end

vagrant@33m~/nov21/cookbooks/apache2/recipes
$ cat stop.rb

service 'apache2' do
  action :stop
end

$ sudo chef-client --local-mode --runlist 'recipe[apache2::default]'


$ sudo chef-client --local-mode --runlist 'recipe[apache2::stop]'


#### Work with chef-server
1. vagrant up of chef-server
2. from workstation - copy and paste knife.rb and admin.pem from https://github.com/AdityaSP/ora-nov19-cpm/chef
vagrant@33m~/nov21/.chef
$ ls -ltra
total 16
drwxrwxr-x 5 vagrant vagrant 4096 Nov 21 09:06 ..
-rw-rw-r-- 1 vagrant vagrant  425 Nov 21 09:08 knife.rb
-rw-rw-r-- 1 vagrant vagrant 1675 Nov 21 09:08 admin.pem
drwxrwxr-x 2 vagrant vagrant 4096 Nov 21 09:08 .

vagrant@33m~/nov21/.chef


vagrant@33m~/nov21
$ knife ssl fetch
WARNING: Certificates from chef-server.test will be fetched and placed in your trusted_cert
directory (/home/vagrant/nov21/.chef/trusted_certs).

Knife has no means to verify these are the correct certificates. You should
verify the authenticity of these certificates after downloading.

Adding certificate for chef-server_test in /home/vagrant/nov21/.chef/trusted_certs/chef-server_test.crt

vagrant@33m~/nov21
$ knife ssl check
Connecting to host chef-server.test:443
Successfully verified certificates from `chef-server.test'

vagrant@33m~/nov21/cookbooks
$ knife cookbook upload apache2
Uploading apache2        [0.1.0]
Uploaded 1 cookbook.


